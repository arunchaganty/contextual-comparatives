{% extends "base.html" %}

{% block body %}
<div class="page-header">
<h1>Describe a numeric expression in English</h1>
</div>

<div class="col-md-12">

<div class="panel panel-default panel-info">
  <div class="panel-heading">
    <h3 class="panel-title">Instructions</h3>
  </div>
  <div class="panel-body">
  <p>
  In each part of this task, you will be given an expression that describes a number (e.g. 10 guns) as the <i>multiplication</i> of a few other facts, e.g.
    <blockquote> 
      10 guns &asymp; 
      <span style="color:red;"><u><b>3</b></u></span> &times; 
      6 million gun per year (<span style="color:blue;"><u><b>number of guns produced in the US</b></u></span>) &times; 
      1 minute (<span style="color:green;"><u><b>a minute</b></u></span>).
    </blockquote> 
    We would like you to describe their combination in a natural way, for example, either expression below would be considered valid:
    <blockquote>
      &#x2713;  
      10 guns is about <b>the <span style="color:blue;">number of guns produced</span> every <span style="color:red;">three</span> <span style="color:green;">minutes</span> in the US.</b> <br/>
      &#x2713;  
      10 guns is about <b><span style="color:red;">thrice</span> the <span style="color:blue;">number of guns produced</span> in a <span style="color:green;">minute</span>.</b>
    </blockquote>

    Each description you provide <i>must</i> contain the relevant information in the underlined parts of each expression. 
    The following are examples that would not be considered valid:
    <blockquote>
      &#x2717;  
      10 guns is about <b>the number of guns produced per year in the US.</b> <br />
      &#x2717;  
      10 guns is about <b>100 times the number of guns produced per year in the US.</b>
    </blockquote>
  </p>

  <p>
    Here are some further examples: <br/>

    <span class="example">Example</span>
    <blockquote> 
      3 million people &asymp; <u><b>1</b></u> &times; 353 thousand people per day (<u><b>global birth rate</b></u>) &times; 190 minute (<u><b>time taken by a football game</b></u>) <br/>
      &#x2713;  
      3 million people is about <b>the number of people born across the world during a football game.</b> <br/>
      &#x2713;  
      3 million people is about <b>how many babies are born during a football game.</b> <br/>
      &#x2717;  
      3 million people is about <b>how many babies are born in America during a football game.</b> <br/>
    </blockquote> 

    <span class="example">Example</span>
    <blockquote> 
      &#x2713;  
      5 kilograms &asymp; <u><b>1/5000</b></u> &times; 185 pound per person (<b><u>weight of a person</u></b>) &times; 300 people (<b><u>number of employees at Yelp</u></b>) <br />
      &#x2713;  
      5 kilograms is about <b>1/5000th the weight of every Yelp employee put together.</b> <br />
      &#x2717;  
      5 kilograms is about <b>a thousandth the weight of all the employees at Yelp combined.</b> 
    </blockquote> 
  <p>
  <b>Estimated time for task:</b> 2 minutes.
  </p>
  <p>
  <b>Note about evaluation:</b> your submission will be approved after a manual evaluation-- we are mainly looking for well-formed expressions that sound natural to the typical American reader.
  </p>
</div>
</div>


<div class="panel panel-default panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">Task</h3>
  </div>

  <input id="tasks" type="hidden" name="tasks" value="{{tasks}}">

  <div id="tasklist">

  <div id="choice-template" class="checkbox hidden">
    <label>
      <input name="response-@@choice_id@@" type="checkbox"> @@choice_gloss@@
    </label>
  </div>
  <div id="task-template" class="panel panel-default hidden">
    <div class="panel-heading">
      <h4 class="panel-title">Part @@j@@</h4>
    </div>

    <div class="panel-body">
      <!-- Consider the following combination of statements and describe their combination. -->
      <blockquote>
        @@sentence_gloss@@
      </blockquote>

      <div class="form-group">
        <b>@@mention_gloss@@</b> is about:
      </div>
    </div>
  </div>

  </div>

  <div class="alert alert-danger hidden" id="errorBox">
    Some responses were not filled.
  </div>
  <div class="alert alert-success hidden" id="successBox">
    Thank you for your input!
  </div>


<input name="submit" class="btn btn-primary" type="submit" id="submitButton" value="Submit" />

    <script type="text/javascript">
function parseTasks() {
  var tasks = $('#tasks').attr('value').split('\t');
  for(var i = 0; i < tasks.length; i++) {
    tasks[i] = jQuery.parseJSON(tasks[i]);
    for(var j = 0; j < tasks[i].choices.length; j++) {
      tasks[i].choices[j] = jQuery.parseJSON(tasks[i].choices[j]);
    }
  }
  return tasks;
}
var tasks = parseTasks();

  // Aggregate output.
function validateInputs() {
  // Check that the input has been inserted.
  var prompts = getPrompts();
  var success = true;
  var valueStr = "";
  for (var i = 0; i < prompts.length; i++) {
    var response = $("#response-"+i).val();
    if(response.length > 0) {
      if (valueStr.length > 0) {
        valueStr += "\t";
      }
      valueStr += response;
    } else {
      success = false;
    }
  }
  $('#responses').attr("value", valueStr);

  if (success) {
    $("#errorBox").addClass("hidden");
    $("#successBox").removeClass("hidden");
  } else {
    $("#errorBox").removeClass("hidden");
    $("#successBox").addClass("hidden");
  }

  return success;
}

var emptyChoice = {"response_id" : -1, "gloss": "None of the above make any sense."};

function addChoice(choice) {
  var div = $("#choice-template").clone();
  div.html(div.html()
      .replace(/@@choice_id@@/g, choice.response_id)
      .replace(/@@choice_gloss@@/g, choice.gloss));
  div.removeClass("hidden");
  return div;
}

// Create a copy of the template class and replace key variables.
function addTask(i, task) {
  var div = $("#task-template").clone();

  // Set id
  div.attr("id", "task-"+i);
  // Replace @@i@@ and @@prompt@@.
  div.html(div.html()
      .replace(/@@i@@/g, i)
      .replace(/@@j@@/g, i+1)
      .replace(/@@sentence_gloss@@/g, task.sentence_gloss)
      .replace(/@@mention_gloss@@/, task.mention_gloss));
  var choice_list = $(div.find('div.form-group')[0]);
  for (var i = 0; i < task.choices.length; i++) {
    choice_list.append(addChoice(task.choices[i]));
  }
  choice_list.append(addChoice(emptyChoice));
  // Make visible.
  div.removeClass("hidden");
  // Add to the tasklist
  $("#tasklist").append(div);
}

$(document).ready(function() {
  // Render the tasks.
  for(var i = 0; i < tasks.length; i++) {
    addTask(i, tasks[i]);
  }

  // Capture the submit button.
  $('#submitButton').click(validateInputs);
});
    </script>

</div>

</div>

{% endblock %}
